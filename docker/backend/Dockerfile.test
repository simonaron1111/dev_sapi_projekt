FROM eclipse-temurin:21-jdk

# Install Maven
RUN apt-get update && apt-get install -y maven && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Default command runs all tests (unit + integration) matching Jenkinsfile
# Unit tests: mvn -Dintegration-tests.skip=true clean package
# Integration tests: mvn verify -Dunit-tests.skip=true
CMD ["sh", "-c", "mkdir -p /app/reports && echo 'Running unit tests...' && mvn -Dintegration-tests.skip=true clean package && echo 'Unit tests completed' && [ -d target/surefire-reports ] && cp -r target/surefire-reports /app/reports/surefire && echo 'Copied surefire reports' || echo 'No surefire reports found' && [ -d target/site/jacoco ] && cp -r target/site/jacoco /app/reports/jacoco && echo 'Copied jacoco reports' || echo 'No jacoco reports found' && echo 'Running integration tests...' && mvn -Dunit-tests.skip=true verify && echo 'Integration tests completed' && [ -d target/failsafe-reports ] && cp -r target/failsafe-reports /app/reports/failsafe && echo 'Copied failsafe reports' || echo 'No failsafe reports found' && [ -d target/site/jacoco ] && cp -r target/site/jacoco /app/reports/jacoco && echo 'Updated jacoco reports' || echo 'No jacoco reports found' && [ -d target/cucumber-reports ] && cp -r target/cucumber-reports /app/reports/cucumber && echo 'Copied cucumber reports' || echo 'No cucumber reports found' && echo '=== Reports in /app/reports ===' && ls -laR /app/reports || true"]
